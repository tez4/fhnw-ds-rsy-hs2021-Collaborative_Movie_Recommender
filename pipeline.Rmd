---
title: "Collaborative Movie Recommender"
author: Pascal Berger, Lea Bütler & Joël Grosjean
output: html_notebook
---
R-Version: **[Default] [32-bit] C:\\Program Files\\R\\R-4.1.0**

*** 
#### Installieren der Packete

```{r}
packages <- c("tidyverse", "data.table", "lubridate", "ggplot2", "ggthemes", "recommenderlab")

# Noch nicht installierte Pakete installieren
installed_packages <- packages %in% rownames(installed.packages())

if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

# Laden der Packete
invisible(lapply(packages, library, character.only = TRUE))

# summaries zu "TRUE" setzen um summaries anzuzeigen
summaries = TRUE
```

***
#### Datenimport

```{r}
data(MovieLense)
MovieLense
```


```{r}
## look at the first few ratings of the first user
head(as(MovieLense[1,], "list")[[1]])

## visualize part of the matrix
image(MovieLense[1:100,1:100])

## number of ratings per user
hist(rowCounts(MovieLense))

## number of ratings per movie
hist(colCounts(MovieLense))

## mean rating (averaged over users)
mean(rowMeans(MovieLense))

## available movie meta information
head(MovieLenseMeta)

## available user meta information
head(MovieLenseUser["id"])

```
## alle charakter variabeln faktorisieren

```{r}

movies <- as(MovieLense, "data.frame")

movies <- movies %>% mutate_if(is.character, as.factor)

head(movies)

```



```{r}
movies_wider <- pivot_wider(
  movies,
  id_cols = user,
  names_from = item,
  values_from = rating,
  values_fill = NULL,
)

head(movies_wider)
```

***
#### Explorative Datenanalyse

```{r}
df_1 <- movies %>% group_by(item) %>%  summarize(mean_rating = mean(rating)) %>% sample_n(15) %>% arrange(desc(mean_rating))

ggplot(df_1, aes(y = reorder(item, +mean_rating), x = mean_rating)) +
  geom_col(alpha = 1, fill = 'steelblue') +
  scale_y_discrete(expand = c(0,0)) +
  scale_x_continuous(expand = c(0,0)) +
  geom_text(aes(label=round(mean_rating,2)), hjust = 1.3, color = 'white') +
  labs(
    title = "Average movie ratings",
    subtitle = "Random Sample of 15 Movies",
    y = element_blank(),    x = "Average Rating (stars)"
  ) +
  theme_classic() +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.line.x = element_blank(),
        text = element_text(size = 12) # text size
  )

        
```

###### 3.Wie verteilen sich die mittleren Kundenratings pro Film?
```{r}
df3 <- movies %>% 
  group_by(item) %>%  
  summarize(
    mean_rating = mean(rating),
    ratings = n()
  ) %>% 
  mutate(
    more_than_50 = ifelse(ratings >= 50, 'b) mehr als 50 Bewertungen', 'a) weniger als 50 Bewertugen')
  )

ggplot(df3, aes(x = mean_rating)) +
  geom_density(alpha = 1, fill = 'steelblue') +
  scale_y_continuous(expand = c(0,0)) +
  scale_x_continuous(expand = c(0,0)) +
  labs(
    title = "Verteilung mittlere Kundenratings pro Film",
    subtitle = "N = 1664 Filme",
    x = "Durchschnittliche Bewertung", 
    y = "Dichte",
  ) +
  theme_classic() +
  theme(
    text = element_text(size = 12)
  )
```
```{r}
ggplot(df3, aes(x = mean_rating, fill = more_than_50)) +
  geom_density(alpha = 0.5) +
  scale_y_continuous(expand = c(0,0)) +
  scale_x_continuous(expand = c(0,0)) +
  labs(
    title = "Verteilung mittlere Kundenratings pro Film",
    subtitle = "N = 1664 Filme",
    x = "Durchschnittliche Bewertung", 
    y = "Dichte",
    fill = element_blank()
  ) +
  theme_classic() +
  theme(
    text = element_text(size = 12),
    legend.position = 'bottom'
  )
```

```{r}

# kunden auswählen
set.seed(353)
kunden_sample <- movies_wider %>% sample_n(5)
# nach diesen Kunden filtern
kunden_sample_long <- filter(movies, user %in% kunden_sample$user)

kunden_sample
kunden_sample_long


```

```{r}

kunden_sample_long %>% mutate_at(vars(rating), ~ as.integer(round(.x)))

ggplot(kunden_sample_long, aes(x=user, y = rating)) + 
  geom_violin(width=1) + 
  labs(
    title = "Verteilung Kundenratings für zufällig gewählte Kunden",
    subtitle = "N = 5 Kunden",
    x = "Kunden ID", 
    y = "Ausprägung Rating",
  ) +
  theme(
    text = element_text(size = 12),
    legend.position = 'bottom'
  )

```

Hier sehen wir, dass Kunden ziemlich unterschiedliche Bewertungen abgeben. Beispielsweise haben hier in unserer Stichprobe drei von fünf Kunden nie eine ein Stern Bewertung abgegeben. Weiter sehen wir dass Kunden wie zum Beispiel Kunde 814 nur ganzzahlige Bewertungen abgegeben haben. Deshlab müssen die Bewertungen normiert werden.


