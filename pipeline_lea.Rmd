---
title: "Collaborative Movie Recommender"
author: Pascal Berger, Lea Bütler & Joël Grosjean
output: html_notebook
---
R-Version: **[Default] [32-bit] C:\\Program Files\\R\\R-4.1.0**

*** 
#### Installieren der Packete

```{r}
packages <- c("tidyverse", "data.table", "lubridate", "ggplot2", "ggthemes", "recommenderlab")

# Noch nicht installierte Pakete installieren
installed_packages <- packages %in% rownames(installed.packages())

if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

# Laden der Packete
invisible(lapply(packages, library, character.only = TRUE))

# summaries zu "TRUE" setzen um summaries anzuzeigen
summaries = TRUE
```

***
#### Datenimport

```{r}
data(MovieLense)
MovieLense
```


```{r}
## look at the first few ratings of the first user
head(as(MovieLense[1,], "list")[[1]])

## visualize part of the matrix
image(MovieLense[1:100,1:100])

## number of ratings per user
hist(rowCounts(MovieLense))

## number of ratings per movie
hist(colCounts(MovieLense))

## mean rating (averaged over users)
mean(rowMeans(MovieLense))

## available movie meta information
head(MovieLenseMeta)

## available user meta information
head(MovieLenseUser["id"])

```
## alle charakter variabeln faktorisieren

```{r}

movies <- as(MovieLense, "data.frame")

movies <- movies %>% mutate_if(is.character, as.factor)

head(movies)

```



```{r}
#creating rating matrix
movies_wider <- pivot_wider(
  movies,
  id_cols = user,
  names_from = item,
  values_from = rating,
  values_fill = NULL,
)

head(movies_wider)
```

***
#### Explorative Datenanalyse

```{r}
df_1 <- movies %>% group_by(item) %>%  summarize(mean_rating = mean(rating)) %>% sample_n(15) %>% arrange(desc(mean_rating))

df_1

ggplot(df_1, aes(y = reorder(item, +mean_rating), x = mean_rating)) +
  geom_col(alpha = 1, fill = 'steelblue') +
  scale_y_discrete(expand = c(0,0)) +
  scale_x_continuous(expand = c(0,0)) +
  geom_text(aes(label=round(mean_rating,2)), hjust = 1.3, color = 'white') +
  labs(
    title = "Average movie ratings",
    subtitle = "Random Sample of 15 Movies",
    y = element_blank(),    x = "Average Rating (stars)"
  ) +
  theme_classic() +
  theme(axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        axis.line.x = element_blank(),
        text = element_text(size = 12) # text size
  )

        
```

```{r}
MovieLenseMeta
```


###### 2. Wie verteilen sich die Kundenratings gesamthaft und nach Genres?
```{r}
movies_genre <- MovieLenseMeta%>%
  rename(item = title)
movies_genre$url <- NULL
movies_genre[movies_genre == 0] <- NA
a <- which(movies_genre==1,arr.ind=TRUE)
movies_genre[a] <- names(movies_genre)[a[,"col"]]
movies_genre <- movies_genre %>%
  unite("genres", unknown:Western, sep= ",", 
        remove = TRUE, na.rm = TRUE)

movies_mean <- movies%>%
  group_by(item)%>%
  summarise(mean_rating = mean(rating))

df2<-merge(x=movies,y=movies_genre,by="item",all.x=TRUE)%>%
  mutate(genres = strsplit(as.character(genres), ",")) %>%
  unnest(genres)
df2

df2_mean<-merge(x=movies_mean,y=movies_genre,by="item",all.x=TRUE)%>%
  mutate(genres = strsplit(as.character(genres), ",")) %>%
  unnest(genres)

genres <- unique(df2$genres)

df2_mean

```

```{r}
ggplot(movies, aes(x = rating)) +
  geom_histogram(alpha = 0.5, bins = 10) +
  labs(
    title = "Verteilung Kundenratings gesamthaft",
    subtitle = "N = 1664 Filme",
    x = "Kundenbewertungen", 
    y = "Dichte",
    fill = element_blank()
  ) +
  theme_classic() +
  theme(
    text = element_text(size = 12),
    legend.position = 'bottom'
  )
```



```{r}
ggplot(df2, aes(x = rating, fill = genres)) +
  geom_histogram(alpha = 1, bins = 10) +
  facet_wrap(~genres)+
  labs(
    title = "Verteilung Kundenratings nach Genres",
    subtitle = "N = 1664 Filme",
    x = "Durchschnittliche Bewertung", 
    y = "Dichte",
    fill = element_blank()
  ) +
  theme_classic() +
  theme(
    text = element_text(size = 12),
    legend.position = 'bottom'
  )
```

Hier ist zu sehen, dass das Genres Drama am meisten bewertet wurde, wobei DOkumentationen am wenigsten bewertungen erhalten haben. die verteilung der Bewertung  


